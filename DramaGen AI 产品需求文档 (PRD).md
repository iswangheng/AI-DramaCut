# DramaGen AI 产品需求文档 (PRD)

## 1. 全链路工作流 (Pipeline)

### 阶段一：素材导入与自动化预处理 (Ingestion & AI Analysis)
1. **上传与存储**：支持批量上传 1080P/4K 素材，存入本地 `./raw_assets`。
2. **镜头预切分 (Shot Detection)**：
   - 算法：FFmpeg 基于帧间差分自动切分 (Threshold=0.3)。
   - 粒度：毫秒级，生成原始切片元数据。
3. **Gemini 深度理解 (The Brain)**：
   - **多模态打标**：对每个切片调用 Gemini 3 进行描述（动作、情绪、关键台词）。
   - **剧情图谱 (Plot Graph)**：Gemini 汇总全剧，拆解出所有的主线与支线，并标记每条线的“吸引力分数”。
   - **高光候选池**：根据爆款梗配置，AI 自动在全剧中标记出数百个高光候选点。

### 阶段二：模式 A - 高光切片量产 (Highlight Scaler)
- **用户配置**：支持设置“目标切片数量”（例如：生成 100 个高光切片）。
- **自动化筛选**：AI 根据吸引力排名，自动选出前 N 个最符合爆款定义的节点。
- **高精度微调 UI (Tuner)**：
  - **核心组件**：支持毫秒级拖拽的时间轴，辅以 `[ -500ms | -100ms | +100ms | +500ms ]` 按钮组。
  - **实时预览**：微调时，播放器必须锁定在对应毫秒的帧上。
  - **动态结束**：根据剧情完整度自动建议长度，范围 60-120s。

### 阶段三：模式 B - 多版本解说矩阵 (Recap Matrix)
- **解说裂变**：用户设置“目标解说版本数”（如：针对同一条复仇线生成 50 种解说风格）。
- **文案生成**：Gemini 根据不同风格（吐槽版、知性版、营销钩子版）生成文案。
- **音画自动重组**：
  - 调用 ElevenLabs TTS。
  - **语义对齐**：系统自动检索预处理库中与文案最匹配的毫秒画面。
  - **手动覆盖**：UI 允许点击某行文案，从 AI 推荐的候选画面中手动选择更合适的切片。

---

## 2. 交互细节与 UI 规范 (Next.js)

### 2.1 预处理仪表盘 (Processing Center)
- **状态墙**：每个视频素材都有一个进度环（上传 -> 切片 -> Gemini 理解中 -> 就绪）。
- **图谱视图**：点击就绪视频，展示交互式剧情树，可勾选“我要这条线”直接进入模式 B。

### 2.2 模式 A 编辑器 (Highlight Tuner UI)
- **批量列表**：左侧显示 AI 识别出的 100 个高光列表，带缩略图。
- **选中态**：点击列表进入“精修模式”，在时间轴上进行毫秒级对齐。

### 2.3 模式 B 编辑器 (Recap Lab)
- **分段卡片**：每一段解说文案是一个卡片，卡片下方显示对应的视频片段。
- **拖拽替换**：支持将素材库中的切片直接拖入卡片替换当前画面。
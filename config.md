# DramaGen AI 产品需求文档 (PRD)

## 1. 产品概述
DramaGen AI 是一款面向短剧/漫剧剪辑师、投放运营及自媒体博主的智能化视频生产工具。系统深度集成 Gemini 3 的多模态理解能力，实现从原始长视频到高点击短视频的自动化/半自动化产出。

## 2. 核心功能需求

### 2.1 模式 A：高光智能切片 (The Highlight Hook)
**目标**：自动识别并提取剧集中的爆发点，用于投放广告或引流切片。
- **自动检测逻辑**：
  - 调用 Gemini 扫描视频流，根据 `config.json` 中的 `viral_tropes_library`（如：打脸、反转、身份曝光）定位爆发时间戳 $T_{start}$。
  - 自动向后截取 60s - 120s，AI 需通过场景切换、音效减弱或剧情转场点自动判断合理的 $T_{end}$。
- **毫秒级手动微调 (Core)**：
  - **微调步长**：UI 必须提供 `±100ms`, `±500ms`, `±1000ms` 的快捷微调按钮。
  - **实时预览**：微调操作需立即同步视频播放器的关键帧，确保切点不卡顿。
  - **用户动作**：用户可以手动覆盖 AI 建议的起止点，确认后后台重新触发 FFmpeg 任务。

### 2.2 模式 B：深度解说矩阵 (Recap Matrix)
**目标**：通过 AI 解说和画面重组，将多集短剧转化为不同视角的解说视频。
- **多维度解说生成**：
  - **故事线提取**：Gemini 需从原始素材中提取 ≥10 条独立故事线（如：女主复仇线、隐藏身份线、反派破产线）。
  - **版本裂变**：单条故事线支持生成不同风格的文案（悬念钩子版、情绪共鸣版等）。
- **音画匹配流程**：
  - **TTS 合成**：调用 ElevenLabs 生成解说音频，并获取每个词的毫秒级时间轴。
  - **画面检索**：根据解说词语义，从预处理的切片库中自动匹配最相关的画面。
  - **自动排版**：FFmpeg 将配音、降量原音、BGM、匹配画面四合一导出。

## 3. 交互与 UI 设计规范
- **界面风格**：浅色、简约、生产力。背景使用 `#F9FAFB`，组件卡片白色。
- **模式切换**：顶部 Tab 导航：`高光切片模式` | `深度解说模式` | `任务管理`。
- **视频包装 (Remotion)**：
  - **字幕**：默认亮黄色加粗带黑边（抖音爆款风格）。
  - **动画**：字幕需支持随语音节奏的“逐字放大”或“上浮”特效。

## 4. 技术性需求
- **精度控制**：所有时间轴处理必须以 `ms` 为单位。
- **预处理机制**：系统需先对长视频进行镜头检测 (Shot Detection) 并对每一段镜头生成语义标签存入 SQLite。
- **中转 API 适配**：必须适配 `yunwu.ai` 的原生流式返回格式，处理超时和断线重连。

## 5. 验收标准
1. **模式 A**：生成的切片在切换点无画面撕裂，音画同步误差 < 50ms。
2. **模式 B**：生成的解说词需包含“黄金 3 秒钩子”，文案与画面内容相关度 > 80%。
3. **性能**：在本地 M1/M2/M3 芯片环境下，渲染一个 90s 视频时长不应超过视频本身的 2 倍。